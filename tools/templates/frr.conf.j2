frr defaults traditional
service integrated-vtysh-config
log syslog informational

hostname {{ router.name }}
password zebra
enable password zebra

{% for prefix in router.prefixes %}
ip route {{ prefix }} Null0
{% endfor %}

router bgp {{ router.asn }}
  bgp router-id {{ router.router_id }}
  timers bgp 3 9
  no bgp default ipv4-unicast
  no bgp ebgp-requires-policy
{% for peer in router.peers %}
  neighbor {{ peer.neighbor_ip }} remote-as {{ peer.remote_asn }}
  neighbor {{ peer.neighbor_ip }} description {{ peer.neighbor_name }}
{% endfor %}
  !
  address-family ipv4 unicast
{% for prefix in router.prefixes %}
    network {{ prefix }}
{% endfor %}
{% for peer in router.peers %}
    neighbor {{ peer.neighbor_ip }} activate
{% if router.role == 'core' %}
    neighbor {{ peer.neighbor_ip }} route-map CORE-OUT out
{% endif %}
{% endfor %}
  exit-address-family

{% if router.role == 'core' %}
route-map CORE-OUT permit 10
  set local-preference 200
{% endif %}
